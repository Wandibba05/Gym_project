<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Login - GYMNATION</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <div class="logo">GYM<span class="green">N</span><span class="red">ATION</span></div>
  </header>

  <div class="login-page">
    <section class="login-form">
      <h2>Member Login</h2>
      <form id="loginForm">
        <input type="text" id="memberId" placeholder="Enter Membership ID" required />
        <button type="submit">Log In</button>
      </form>
      <p id="loginMsg" style="margin-top: 20px; font-weight: bold;"></p>
    </section>
  </div>

  <script>
    // Auto-fill membership ID if available from signup
    window.addEventListener('load', function() {
      const lastId = sessionStorage.getItem('lastGeneratedId');
      if (lastId) {
        document.getElementById('memberId').value = lastId;
        sessionStorage.removeItem('lastGeneratedId'); // Clear after use
      }
    });

    document.getElementById('loginForm').addEventListener('submit', async function(e){
      e.preventDefault();
      const memberId = document.getElementById('memberId').value.trim();
      const loginMsg = document.getElementById('loginMsg');

      try {
        const response = await fetch('/api/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ userId: memberId })
        });

        const data = await response.json();

        if (response.ok && data.name) {
          loginMsg.style.color = 'green';
          loginMsg.textContent = `Welcome back, ${data.name}!`;
          // Store user session
          sessionStorage.setItem('currentUser', JSON.stringify({
            userId: memberId,
            name: data.name
          }));
          // Redirect to dashboard after successful login
          setTimeout(() => {
            window.location.href = 'dashboard.html';
          }, 1500);
        } else {
          loginMsg.style.color = 'red';
          loginMsg.textContent = 'Invalid Membership ID. Please try again.';
        }
      } catch (error) {
        console.error('Error:', error);
        loginMsg.style.color = 'red';
        loginMsg.textContent = 'Login failed. Please try again.';
      }
    });
  </script>
</body>
</html>